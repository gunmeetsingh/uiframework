version: '3.8'

services:
  oam-portal:
    # Option 1: Manual Build (Requires full source code package)
    # build:
    #   context: .
    #   dockerfile: Dockerfile

    # Option 2: Registry Pull (Recommended - No source code package needed)
    image: ghcr.io/<your-username>/uiframework:main

    container_name: oam-portal
    ports:
      - "3000:3000"
    environment:
      - DATABASE_URL=mysql://user:pass@mysql-endpoint:3306/oam_portal
      - AUTH_MODE=local # Change to keycloak once logic is ready
      - NEXTAUTH_URL=http://server-ip:3000
      - NEXTAUTH_SECRET=p3rs1st3nt_s3cr3t_f0r_prod
      - KEYCLOAK_ID=nextjs-app
      - KEYCLOAK_SECRET=dummy-secret
      - KEYCLOAK_ISSUER=http://server-ip:8080/realms/spartified
    depends_on:
      - keycloak
    restart: always

  keycloak:
    image: quay.io/keycloak/keycloak:22.0.1
    container_name: keycloak
    command: start-dev --http-relative-path /auth
    ports:
      - "8080:8080"
    environment:
      - KC_DB=mysql
      - KC_DB_URL=jdbc:mysql://mysql-endpoint:3306/keycloak
      - KC_DB_USERNAME=user
      - KC_DB_PASSWORD=pass
      - KC_HOSTNAME=server-ip
      - KEYCLOAK_ADMIN=admin
      - KEYCLOAK_ADMIN_PASSWORD=admin
    restart: always
